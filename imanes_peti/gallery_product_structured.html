<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
    <meta name="mobile-web-app-capable" content="yes">
    <title>Elegant Gallery & Product Details</title>
    
    <!-- External Dependencies -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Condensed:wght@300;400;600;700&display=swap" rel="stylesheet">
    
    <!-- Modular Styles -->
    <link rel="stylesheet" href="./styles/theme.css">
</head>
<body>
    <!-- Gallery View Container -->
    <div id="galleryView" class="min-h-screen p-4 md:p-8">
        <!-- Header Component -->
        <div id="headerComponent"></div>

        <!-- Gallery Grid -->
        <div class="max-w-7xl mx-auto">
            <div id="productGrid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
                <!-- Product cards will be populated by JavaScript -->
            </div>
        </div>
    </div>

    <!-- Product Detail View Container -->
    <div id="productDetailView" class="hidden">
        <!-- Sticky Header Component -->
        <div id="stickyHeaderComponent"></div>

        <!-- Product Detail Content -->
        <div id="productDetailContent"></div>
    </div>
    
    <!-- Footer Component -->
    <div id="footerComponent"></div>

    <!-- Modular JavaScript -->
    <script src="./scripts/productData.js"></script>
    <script src="./scripts/uiController.js"></script>
    <script>
        // Initialize the application
        document.addEventListener('DOMContentLoaded', function() {
            initializeApp();
        });

        function initializeApp() {
            // Initialize Lucide icons
            lucide.createIcons();
            
            // Load components
            loadComponents();
            
            // Populate gallery with products
            populateGallery();
        }

        async function loadComponents() {
            // In React, these would be imported components
            // For now, we'll load them dynamically
            
            // Load header
            const headerResponse = await fetch('./components/Header.html');
            const headerHTML = await headerResponse.text();
            document.getElementById('headerComponent').innerHTML = headerHTML;
            
            // Load sticky header
            const stickyHeaderResponse = await fetch('./components/StickyHeader.html');
            const stickyHeaderHTML = await stickyHeaderResponse.text();
            document.getElementById('stickyHeaderComponent').innerHTML = stickyHeaderHTML;
            
            // Load footer
            const footerResponse = await fetch('./components/Footer.html');
            const footerHTML = await footerResponse.text();
            document.getElementById('footerComponent').innerHTML = footerHTML;
            
            // Reinitialize icons after loading components
            lucide.createIcons();
        }

        function populateGallery() {
            const productGrid = document.getElementById('productGrid');
            const products = ProductDataHelpers.getAllProducts();
            
            productGrid.innerHTML = products.map(product => `
                <div class="product-card glass-effect rounded-2xl p-6 fade-in">
                    <div class="aspect-[2/3] mb-4 overflow-hidden rounded-xl cursor-pointer" onclick="showProductDetail(${product.id})">
                        <img src="${product.mainImage}" 
                             alt="${product.title}" 
                             class="w-full h-full object-cover transition-transform duration-300 hover:scale-105"
                             loading="lazy"
                             onerror="this.style.display='none'">
                    </div>
                    <h3 class="text-xl font-semibold mb-2">${product.title}</h3>
                    <p class="text-gray-600 mb-4">${product.description}</p>
                    <div class="flex justify-between items-center mb-4">
                        <span class="text-2xl font-bold gradient-text">${product.price}</span>
                        <div class="flex items-center">
                            <i data-lucide="star" class="w-4 h-4 text-yellow-400 fill-current"></i>
                            <span class="ml-1 text-sm text-gray-600">${product.ratingValue}</span>
                        </div>
                    </div>
                    <button onclick="showProductDetail(${product.id})" class="w-full btn-primary py-3 px-4 rounded-xl font-semibold flex items-center justify-center space-x-2">
                        <span>ver m√°s</span>
                        <i data-lucide="arrow-right" class="w-4 h-4"></i>
                    </button>
                </div>
            `).join('');
            
            // Reinitialize icons
            lucide.createIcons();
        }
        
        // Override the UI controller's updateProductDetailView to use component
        const originalUpdateProductDetailView = uiController.updateProductDetailView;
        uiController.updateProductDetailView = async function() {
            if (!this.selectedProduct) return;

            // Load product detail component
            const productDetailResponse = await fetch('./components/ProductDetail.html');
            let productDetailHTML = await productDetailResponse.text();
            
            // Replace template variables (in React, these would be props)
            productDetailHTML = productDetailHTML
                .replace(/\$\{product\.title\}/g, this.selectedProduct.title)
                .replace(/\$\{product\.mainImage\}/g, this.selectedProduct.mainImage)
                .replace(/\$\{product\.rating\}/g, this.selectedProduct.rating)
                .replace(/\$\{product\.price\}/g, this.selectedProduct.price)
                .replace(/\$\{product\.description\}/g, this.selectedProduct.description)
                .replace(/\$\{product\.stock\}/g, this.selectedProduct.stock);
            
            document.getElementById('productDetailContent').innerHTML = productDetailHTML;
            
            // Call original method to populate dynamic content
            originalUpdateProductDetailView.call(this);
        };
    </script>
</body>
</html>